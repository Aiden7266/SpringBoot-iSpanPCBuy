<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登入註冊</title>
    <link rel="stylesheet" href="https://kit.fontawesome.com/d761e55d24.css" crossorigin="anonymous">
    <!-- 添加了 crossorigin="anonymous"意味前端向服務端發送了跨域請求。
        服務端若不允許你的這個請求通過，那就導致拒絕請求這地址，數據加載不來。-->
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<body>
<div class="shell">
    <link rel="stylesheet" href="../assets/css/login_register.css">
    <!--登入-->
    <div class="container login_Msg" id="login_Msg">
        <form class="form" id="a-form" action="/login" method="post" >
            <h2 class="form_title title">登入會員</h2>
            <div class="form_icons"></div>
            <input type="text" class="form_input" placeholder="帳號" name="username" required>
            <input type="password" class="form_input" placeholder="密碼" name="password" required>
            <p class="form_link"> <input type="checkbox" name="remember-me"> 保持登入</p>
            <input type="submit" class="form_button button" id="loginrule" value="SIGN IN">
            <br><br>
        </form>
    </div>

    <!--註冊-->
    <div class="container register_Msg" id="register_Msg">
        <form class="form" id="b-form" action="" method="POST" >
            <h2 class="form_title title">註冊帳號</h2>
            <div class="form_icons">
                <div class="form-group">
                    <label for="name" class="control-label">姓名：</label>
                    <input type="text" class="form_input" id="name" name="name" placeholder="輸入姓名" required
                           minlength="2" maxlength="20"
                           oninvalid="setCustomValidity('請輸入姓名，長度限制最少2字數，最多20字數內')">
                </div>
                <div class="form-group">
                    <label for="tel" class="control-label">電話：</label>
                    <input type="text" class="form_input" id="tel" name="tel" placeholder="輸入手機號碼(格式:09xxxxxxxx)" required
                           maxlength="10" pattern="[09]{2}[0-9]{8}"
                           oninvalid="setCustomValidity('請輸入正確的手機號瑪格式:09xxxxxxxx')">
                </div>
                <div class="form-group">
                    <label for="addr" class="control-label">地址：</label>
                    <input type="text" class="form_input" id="addr" name="addr" placeholder="輸入地址" required
                           minlength="6" maxlength="200" pattern="(?\D+?[縣市])(?\D+?(市區|鎮區|鎮市|[鄉鎮市區]))?(?\D+?[村里])?(?\d+[鄰])?(?\D+?(村路|[路街道段]))?(? \D?段)?(?\d+巷)?(?\d+弄)?(?\d+號?)?(?-\d+?(號))?(?\d+樓)?(?.+)?"
                           oninvalid="setCustomValidity('請輸入地址，長度限制100字以內')">
                </div>
                <div class="form-group">
                    <label for="email" class="control-label">信箱：</label>
                    <input type="email" class="form_input" id="email" name="email" placeholder="輸入電子郵件地址" required
                           pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                           oninvalid="setCustomValidity('請輸入正確電子郵件格式')">
                </div>
                <div class="form-group">
                    <label for="username" class="control-label">帳號：</label>
                    <input type="text" class="form_input" id="username" name="username" placeholder="輸入帳號(最少7位數)" required
                           minlength="7" maxlength="20"
                           oninvalid="setCustomValidity('請輸入帳號，長度限制20字以內')">
                </div>
                <div class="form-group">
                    <label for="password" class="control-label">密碼：</label>
                    <input type="password" class="form_input" id="password" name="password" placeholder="輸入密碼(需含英數至少六個字元)" required
                           pattern="^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$"
                           oninvalid="setCustomValidity('請輸入正確的密碼格式:含英數至少六個字元')" >
                </div>

                <div class="form-group">
                    <label for="password" class="control-label">密碼確認：</label>
                    <input type="password" class="form_input" id="password_confirm" name="password" placeholder="輸入確認密碼" required
                           pattern="^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$"
                           onchange="if(document.getElementById('password').value != document.getElementById('password_confirm').value){setCustomValidity('密碼不吻合')}">
                </div>
            </div>
            <input  type="button" class="form_button button submit" id="signrule" value="SIGN UP" onclick="register()"></input>
        </form>
    </div>

    <div class="switch" id="switch-cnt">
        <div class="switch_circle"></div>
        <div class="switch_circle switch_circle-t"></div>
        <div class="switch_container" id="switch-c1">
            <button class="switch_button button switch-btn">SIGN IN</button>
        </div>
        <div class="switch_container is-hidden" id="switch-c2">
            <button class="switch_button button switch-btn">SIGN UP</button>
        </div>
    </div>
</div>
</body>

</html>
<script>
    let switchCtn = document.querySelector("#switch-cnt");
    let switchC1 = document.querySelector("#switch-c1");
    let switchC2 = document.querySelector("#switch-c2");
    let switchCircle = document.querySelectorAll(".switch_circle");
    let switchBtn = document.querySelectorAll(".switch-btn");
    let aContainer = document.querySelector("#login_Msg");
    let bContainer = document.querySelector("#register_Msg");
    let allButtons = document.querySelectorAll(".submit");

    let getButtons = (e) => e.preventDefault()
    let changeForm = (e) => {
        // 修改類
        switchCtn.classList.add("is-gx");
        setTimeout(function () {
            switchCtn.classList.remove("is-gx");
        }, 1500)
        switchCtn.classList.toggle("is-txr");
        switchCircle[1].classList.toggle("is-txr");
        switchCircle[0].classList.toggle("is-txr");

        switchC1.classList.toggle("is-hidden");
        switchC2.classList.toggle("is-hidden");
        aContainer.classList.toggle("is-txl");
        bContainer.classList.toggle("is-txl");
        bContainer.classList.toggle("is-z");
    }
    // 點擊切換
    let shell = (e) => {
        for (var i = 0; i < allButtons.length; i++)
            allButtons[i].addEventListener("click", getButtons);
        for (var i = 0; i < switchBtn.length; i++)
            switchBtn[i].addEventListener("click", changeForm)
    }
    window.addEventListener("load", shell);
</script>

<script>
    function register() {
        var x = true
        $('#a-form input').each(function (){
            if($(this).val() == ""){
                x = false
            }
        })
        if (!x){
                alert("有東西還沒填")
        }
        else if ( $('#password_confirm').val()!=$('#password').val()){
            alert("密碼不相符，請再次確認")
            x = false
        }
        if(x){
            $.ajax({
                type: 'post',
                url: '/users/register',
                data: JSON.stringify({
                    username:$('#username').val(),
                    password:$('#password').val(),
                    name:$('#name').val(),
                    tel:$('#tel').val(),
                    addr:$('#addr').val(),
                    email:$('#email').val()
                }),
                contentType : 'application/json',
                success: function(data) {
                    console.log(data)
                    alert("您已註冊成功，請登入!");
                }
            });
        }
    }
</script>

</html>