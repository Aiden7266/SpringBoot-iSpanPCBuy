<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description">
    <meta name="author">

    <title>會員資料-會員頁面</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Add custom CSS here -->
    <link href="css/sb-admin.css" rel="stylesheet">
    <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
  </head>

  <body>
  <link rel="stylesheet" href="css/memberinfo_style.css">
  <div id="wrapper">
      <!--        style="background-color:#eab0b0"-->
      <nav class="navbar navbar-inverse navbar-fixed-top"  >
          <div class="navbar-header">
              <button type="button" class="navbar-toggle">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="member_index.html"><img src="../assets/images/PCBUY_logo.png" style="width: 85px;height: 17px;position: relative">&nbsp;會員中心</a>
          </div>

          <div>
              <ul class="nav navbar-nav side-nav">
                  <li><a href="member_index.html"><i class="fa fa-home"></i> 首頁 </a></li>
                  <li><a href="member_cart.html"><i class="fa fa-shopping-cart"></i>  購物車 </a></li>
                  <li><a href="member_order.html"><i class="fa fa-file-text-o"></i>  我的訂單 </a></li>
                  <li><a href="member_info.html" style="background-color: #ebc59c; color:black;"><i class="fa fa-user"></i>  會員資訊 </a></li>
                  <li><a href="../index.html" style="position:fixed; bottom:20px; left:0;"><i class="fa fa-backward"></i> 返回官網 </a></li>
                  <li><a href="/admin/admin_index.html" style="position:fixed; bottom:70px; left:0;"><i class="fa fa-star"></i> 進階模式 </a></li>
              </ul>

              <ul class="nav navbar-nav navbar-right navbar-user">
                  <li>
                      <a href="" id="loginName"><i class="fa fa-users"></i></a>
                  <li></li>
                  <li><a href="/logout"><i class="fa fa-power-off"></i> Log Out</a></li>
                  </li>
              </ul>
          </div>
      </nav>

      <div id="page-wrapper">
          <div class="row">
              <div class="col-lg-12">
                  <h1>會員資訊</h1>
                  <ol class="breadcrumb">
                      <li><a href="member_index.html"><i class="fa fa-home"></i> 首頁 </a></li>
                      <li class="active"> 會員資訊 </li>
                  </ol>
              </div>
          </div>

          <table class="table table-striped">
              <tbody>
              <tr>
                  <th >姓名</th>
                  <td id="td-name"></td>
              </tr>
              <tr>
                  <th >電話</th>
                  <td id="td-tel"></td>
              </tr>
              <tr>
                  <th >地址</th>
                  <td id="td-addr"></td>
              </tr>
              <tr>
                  <th>信箱</th>
                  <td id="td-email"></td>
              </tr>
              <tr>
                  <th>帳號</th>
                  <td id="td-username"></td>
              </tr>
              </tbody>
          </table>
          <input type="button" value="修改個人資料" id="btn-update" style="background-color: #1e7e34">
      </div>
  </div>
    <!-- JavaScript -->
    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.js"></script>
  <dialog id="infoModal-update">
      <p id="updateFormTitle"> 修改會員基本資料 </p>
      <hr>
      <form action="" method="post" id="update-memberinfo-form" onsubmit="return false">
          <div>
              <label for="name-update" class="update-form">姓名</label>
              <input type="text" id="name-update">

              <label for="tel-update" class="update-form">電話</label>
              <input type="text" id="tel-update">

              <label for="addr-update" class="update-form">地址</label>
              <input type="text" id="addr-update">

              <label for="email-update" class="update-form">信箱</label>
              <input type="email" id="email-update">

              <label for="username-update" class="update-form">帳號</label>
              <input type="text" id="username-update" disabled>

<!--              <label for="password-update" class="update-form">密碼</label>-->
<!--              <input type="password" id="password-update">-->

<!--              <label for="confirm_password-update" class="update-form">確認密碼</label>-->
<!--              <input type="password" id="confirm_password-update">-->

              <div style="text-align:center;">
                  <input type="button" id="update-close" value="關閉">
                  <input type="submit" id="update-send" value="送出">
              </div>
          </div>
      </form>
  </dialog>

  <script type="text/javascript">
      var userId, username, name, email, tel, addr
      let infoModal = document.querySelector("#infoModal-update")
      $(document).ready(function () {
          $.ajax({
              url: '/users/current',
              type: "get",
              dataType: "json",
              success: function (userinfo) {
                  console.log(userinfo)
                  userId = userinfo.userId
                  username = userinfo.username
                  name = userinfo.name
                  email = userinfo.email
                  tel = userinfo.tel
                  addr = userinfo.addr
                  $('#td-name').text(name)
                  $('#td-tel').text(tel)
                  $('#td-addr').text(addr)
                  $('#td-email').text(email)
                  $('#td-username').text(username)
                  $('#loginName').append(' ' + name)
              }
          })

      })

      $('#btn-update').click(function () {
          $('#name-update').val(name)
          $('#tel-update').val(tel)
          $('#addr-update').val(addr)
          $('#email-update').val(email)
          $('#username-update').val(username)
          infoModal.showModal()
      })

      $('#update-close').click(function () {
          infoModal.close()
      })
      $('#update-send').click(function () {
          $.ajax({
              url: '/users/' + userId,
              type: "put",
              dataType: "json",
              data:JSON.stringify({
                  name:$('#name-update').val(),
                  tel:$('#tel-update').val(),
                  addr:$('#addr-update').val(),
                  email:$('#email-update').val()
              }),
              contentType:"application/json",
              success: function (user) {
                  console.log(user)
                  location.reload()
              },error:function () {
                  alert("error")
              }
          })
          infoModal.close()
      })
  </script>
  </body>
</html>